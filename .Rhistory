# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th,lwd=1.5,col='darkgray',lty=2)
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th,lwd=2,col='darkgray',lty=2)
i
q
j
w
x
score
s
score[s]
enb
env
liab
t_sick
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
risk_red_sim
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,1))
qs
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,1))
disease_count
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,1))
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th*100,lwd=2,col='darkgray',lty=2)
qs
risk_red_th
risk_red_th*100
risk_red_sim*100
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,100))
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th*100,lwd=2,col='darkgray',lty=2)
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
t_exclude
q
r2
qnorm(1-q)*sqrt(r2)
disease_count/nfam
K-disease_count/nfam
(K-disease_count/nfam)/K
liab
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
(K-disease_count/nfam)/K
disease_count
ls()
rm(list=ls())
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/RiskReduction.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
par(mfrow=c(1,1))
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,100))
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th*100,lwd=2,col='darkgray',lty=2)
risk_red_th
risk_red_sim
library(MASS)
risk_reduction = function(r2,method,K,n=10,q=0.01)
{
r = sqrt(r2)
zk = qnorm(K, lower.tail=F)
if (method==1) # Exclude high-risk, q-percentile
{
zq = qnorm(q, lower.tail=F)
integrand1 = function(t)
{
y = dnorm(t)*pnorm((zk-r*t)/sqrt(1-r^2),lower.tail=F)
return(y)
}
risk= integrate(integrand1,-Inf,zq)$value / (1-q)
}
if (method==2) # Select lowest-risk
{
integrand2 = function(t)
{
arg = (zk-t*sqrt(1-r2/2)) / (r/sqrt(2))
y = dnorm(t)*pnorm(arg, lower.tail=F)^n
return(y)
}
risk= integrate(integrand2,-Inf,Inf)$value
}
if (method==3) # Select high-risk (method 2)
{
integrand3 = function(t)
{
arg = (zk-t*sqrt(1-r2)) / r
y = dnorm(t)*(1-pnorm(arg)/(1-q))
return(y)
}
zq = qnorm(q, lower.tail=F)
risk= integrate(integrand3,(zk-zq*r)/sqrt(1-r2),Inf)$value
}
if (method==4) # Select lowest-risk (method 2)
{
integrand4 = function(t)
{
arg = (zk-t*r/sqrt(2)) / sqrt(1-r2/2)
y = n*dnorm(t)*pnorm(t,lower.tail = F)^(n-1)*pnorm(arg, lower.tail=F)
return(y)
}
risk= integrate(integrand4,-Inf,Inf)$value
}
reduction = (K-risk)/K
return(reduction)
}
risk_red_th = numeric(length(qs))
for (i in seq_along(qs))
{
q = qs[i]
risk_red_th[i] = risk_reduction(r2,1,K,q=q)
}
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,100))
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th*100,lwd=2,col='darkgray',lty=2)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
?rnorm
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/RandEmbryoSim.R')
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(qs*100,risk_red_th*100,lwd=2,col='darkgray',lty=2)
legend('topleft',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
risk_red_sim
library(MASS)
risk_reduction_lowest = function(r2,K,n)
{
r = sqrt(r2)
zk = qnorm(K, lower.tail=F)
integrand_lowest = function(t)
{
arg = (zk-t*sqrt(1-r2/2)) / (r/sqrt(2))
y = dnorm(t)*pnorm(arg, lower.tail=F)^n
return(y)
}
risk= integrate(integrand_lowest,-Inf,Inf)$value
reduction = (K-risk)/K
return(reduction)
}
risk_reduction_lowest(0.1,0.1,3)
risk_reduction_lowest(0.1,0.1,4)
risk_reduction_lowest(0.1,0.01,4)
risk_reduction_lowest(0.01,0.01,4)
risk_reduction_lowest(0.01,0.01,15)
risk_reduction_lowest(0.1,0.1,15)
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
rm(list=ls())
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
# index = 3
# segments(qs[index]*100,-10,qs[index]*100,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
# segments(qs[index]*100,risk_red_1[index]*100,-10,risk_red_1[index]*100,col='darkgray',lty=1,lwd=2)
lines(ns,risk_red_th*100,lwd=2,col='darkgray',lty=2)
legend('topleft',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
lines(ns,risk_red_th*100,lwd=2,col='darkgray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
lines(ns,risk_red_th*100,lwd=2,col='darkgray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
png("../Figures/LowestRisk.png",width=1000,height=500,res=300)
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
dev.off()
png("../Figures/LowestRisk.png",1000,500,res=300)
setwd("D:/Work/Projects/Prediction/Code/embryo_selection")
png("../Figures/LowestRisk.png",1000,500,res=300)
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
dev.off()
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
png("../Figures/LowestRisk.png",1000,500,res=300)
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
dev.off()
rm(list=ls())
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
png("../Figures/LowestRisk.png",1000,500,res=300)
par(mar=c(4.5,5,1,1))
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
dev.off()
png("../Figures/LowestRisk.png",1400,1000,res=300)
par(mar=c(4.5,5,1,1))
plot(ns,risk_red_sim*100,cex=1.5,xlab="Number of embryos",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Lowest risk',font.main=1,ylim=c(0,100))
lines(ns,risk_red_th*100,lwd=2,col='DarkSlateGray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 4
segments(ns[index],-10,ns[index],risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
segments(ns[index],risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=2,lwd=2)
dev.off()
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Lowest.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Exclude.R')
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('topleft',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Exclude.R')
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
png("../Figures/ExcludeHigh.png",1400,1000,res=300)
par(mar=c(4.5,5,1,1))
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
dev.off()
source('D:/Work/Projects/Prediction/Code/embryo_selection/EmbryoSim_Exclude.R')
png("../Figures/ExcludeHigh.png",1400,1000,res=300)
par(mar=c(4.5,5,1,1))
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
dev.off()
par(mar=c(4.5,5,1,1))
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
par(mar=c(4.5,5,1,1))
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
risk_red_sim
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
library(rmutil)
install.packages("rmutil")
library(rmutil)
?int2
?integrate
risk_red_th = numeric(length(qs))
for (i in seq_along(qs))
{
q = qs[i]
risk_red_th[i] = risk_reduction_exclude2(r2,K,q)
}
risk_reduction_exclude2 = function(r2,K,q)
{
r = sqrt(r2)
zk = qnorm(K, lower.tail=F)
zq = qnorm(q, lower.tail=F)
a = zq/sqrt(2)
integrand_t = function(t,x)
{
y = dnorm(t)*pnorm((zk-r/sqrt(2)*(x+t))/sqrt(1-r^2),lower.tail=F)
return(y)
}
integrand_x = function(x)
{
y = dnorm(x)/pnorm(a-x)*integrate(integrand_t,-Inf,a-x,x)$value
return(y)
}
risk = integrate(integrand_x,-Inf,Inf)$value
reduction = (K-risk)/K
return(reduction)
}
for (i in seq_along(qs))
{
q = qs[i]
risk_red_th[i] = risk_reduction_exclude2(r2,K,q)
}
a
qnorm(0.01,lower.tail = F)
qnorm(0.01,lower.tail = F)/sqrt(2)
integrate(integrand_t,-Inf,1/5-1,1)$value
integrand_t = function(t,x)
{
y = dnorm(t)*pnorm((zk-r/sqrt(2)*(x+t))/sqrt(1-r^2),lower.tail=F)
return(y)
}
integrate(integrand_t,-Inf,1.5-1,1)$value
source('~/.active-rstudio-document')
debugSource('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
zk
zq
debugSource('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
x
dnorm(c(1,2,3))
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
risk_reduction_exclude2(0.1,0.01,0.02)
xs
x
xs
t
x
y
x
x
x
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
risk_reduction_exclude2(0.1,0.01,0.02)
xs
y
risk_reduction_exclude2(0.1,0.01,0.02)
y
x
x
x
y
debugSource('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
x
t
x
x
x
xs
t
x
t+x
y
t
x
x
y
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
log(dnorm(-100))
dnorm(-100)
dnorm(100)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
warnings()
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
debugSource('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
y
y
y
y
y
ts
x
x
y
y
x
ts
ts
x
x
ts
x
x
x
x
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
pnorm(-233)
.Machine$double.eps
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.1,0.01,0.02)
risk_reduction_exclude2(0.2,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.2,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.2,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.2,0.01,0.02)
source('D:/Work/Projects/Prediction/Code/embryo_selection/temp.R')
risk_reduction_exclude2(0.2,0.01,0.02)
risk_reduction_exclude2 = function(r2,K,q)
{
r = sqrt(r2)
zk = qnorm(K, lower.tail=F)
zq = qnorm(q, lower.tail=F)
a = zq/sqrt(2)
integrand_t = function(t,x)
{
y = dnorm(t)*pnorm((zk-r/sqrt(2)*(x+t))/sqrt(1-r^2),lower.tail=F)
return(y)
}
integrand_x = function(xs)
{
y = numeric(length(xs))
for (i in seq_along(xs))
{
x = xs[i]
temp = integrate(integrand_t,-Inf,a-x,x)$value
denom = pnorm(a-x)
if (denom==0) {denom=1e-300}
y[i] = dnorm(x)*temp/denom
}
return(y)
}
risk = integrate(integrand_x,-Inf,Inf)$value
reduction = (K-risk)/K
return(reduction)
}
for (i in seq_along(qs))
{
q = qs[i]
risk_red_th[i] = risk_reduction_exclude2(r2,K,q)
}
risk_red_th
par(mar=c(4.5,5,1,1))
plot(qs*100,risk_red_sim*100,cex=1.5,xlab="Percentile PS to exclude",ylab="Risk reduction(%)",cex.lab=1.5,cex.axis=1.25,lwd=2,main='Exclude high-risk',font.main=1,ylim=c(0,50))
lines(qs*100,risk_red_th*100,lwd=2,col='darkslategray',lty=1)
legend('bottomright',c(sprintf("Prevalence=%g",K),as.expression(bquote('r'^'2'*'='*.( r2)))),bty='n',cex=1.3,text.col='darkblue')
index = 2
segments(qs[index]*100,-10,qs[index]*100,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
segments(qs[index]*100,risk_red_sim[index]*100,-10,risk_red_sim[index]*100,col='darkgray',lty=1,lwd=2)
plot(c(1,2,3),c(4,5,6))
